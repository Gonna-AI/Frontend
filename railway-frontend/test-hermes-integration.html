<!DOCTYPE html>
<html>
<head>
    <title>Hermes 2 Pro Integration Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0c0; }
        #output {
            background: #000;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #0f0;
            white-space: pre-wrap;
            min-height: 400px;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0ff; }
    </style>
</head>
<body>
    <h1>üß™ Hermes 2 Pro Integration Test</h1>
    <p>Test the local LLM integration with optimized settings</p>
    
    <button onclick="testAvailability()">1. Test Availability</button>
    <button onclick="testBasicResponse()">2. Basic Response</button>
    <button onclick="testFunctionCalling()">3. Function Calling</button>
    <button onclick="testPerformance()">4. Performance Test</button>
    <button onclick="clearOutput()">Clear</button>
    
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<span class="${type}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }
        
        async function testAvailability() {
            log('Testing Ollama availability...', 'info');
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                const data = await response.json();
                log(`‚úÖ Ollama is running!`, 'success');
                log(`   Models: ${data.models.map(m => m.name).join(', ')}`, 'info');
                log(`   Model size: ${(data.models[0].size / 1e9).toFixed(1)}GB`, 'info');
            } catch (error) {
                log(`‚ùå Ollama not accessible: ${error.message}`, 'error');
            }
        }
        
        async function testBasicResponse() {
            log('\\nTesting basic response...', 'info');
            const start = Date.now();
            try {
                const response = await fetch('http://localhost:11434/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'adrienbrault/nous-hermes2pro:Q4_K_M',
                        messages: [
                            { role: 'user', content: 'Hello, my name is Sarah Johnson' }
                        ],
                        stream: false,
                        keep_alive: '5m',
                        options: {
                            num_ctx: 2048,
                            num_predict: 100,
                            num_thread: 8,
                            temperature: 0.7
                        }
                    })
                });
                
                const data = await response.json();
                const duration = Date.now() - start;
                
                log(`‚úÖ Response received in ${duration}ms`, 'success');
                log(`   AI: ${data.message.content}`, 'info');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function testFunctionCalling() {
            log('\\nTesting function calling...', 'info');
            const start = Date.now();
            try {
                const response = await fetch('http://localhost:11434/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'adrienbrault/nous-hermes2pro:Q4_K_M',
                        messages: [
                            { role: 'system', content: 'You are a call agent. Extract caller info.' },
                            { role: 'user', content: 'Hi, my name is John Smith and I need urgent help with billing' }
                        ],
                        tools: [{
                            type: 'function',
                            function: {
                                name: 'extract_caller_info',
                                description: 'Extract caller information',
                                parameters: {
                                    type: 'object',
                                    properties: {
                                        callerName: { type: 'string' },
                                        callPurpose: { type: 'string' },
                                        urgencyLevel: { type: 'string', enum: ['low', 'medium', 'high', 'critical'] }
                                    }
                                }
                            }
                        }],
                        stream: false,
                        keep_alive: '5m',
                        options: {
                            num_ctx: 2048,
                            num_predict: 256,
                            num_thread: 8,
                            mirostat: 0,
                            low_vram: true
                        }
                    })
                });
                
                const data = await response.json();
                const duration = Date.now() - start;
                
                log(`‚úÖ Response received in ${duration}ms`, 'success');
                log(`   Text: ${data.message.content || 'None'}`, 'info');
                log(`   Tool calls: ${data.message.tool_calls ? JSON.stringify(data.message.tool_calls, null, 2) : 'None'}`, 'info');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function testPerformance() {
            log('\\nPerformance Test (3 sequential requests)...', 'info');
            
            const times = [];
            for (let i = 1; i <= 3; i++) {
                const start = Date.now();
                try {
                    await fetch('http://localhost:11434/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: 'adrienbrault/nous-hermes2pro:Q4_K_M',
                            messages: [{ role: 'user', content: `Test message ${i}` }],
                            stream: false,
                            keep_alive: '5m',
                            options: { num_ctx: 2048, num_predict: 50, num_thread: 8 }
                        })
                    });
                    const duration = Date.now() - start;
                    times.push(duration);
                    log(`   Request ${i}: ${duration}ms`, 'success');
                } catch (error) {
                    log(`   Request ${i}: Failed - ${error.message}`, 'error');
                }
            }
            
            if (times.length > 0) {
                const avg = Math.round(times.reduce((a, b) => a + b) / times.length);
                const min = Math.min(...times);
                const max = Math.max(...times);
                log(`\\nüìä Results:`, 'info');
                log(`   Average: ${avg}ms`, 'success');
                log(`   Fastest: ${min}ms`, 'success');
                log(`   Slowest: ${max}ms`, 'success');
                
                if (max > 3000) {
                    log(`\\nüí° TIP: Run the optimization script to reduce cold-start lag!`, 'info');
                    log(`   cd /Users/animesh/clekrtree/Frontend`, 'info');
                    log(`   ./setup-ollama-optimization.sh`, 'info');
                }
            }
        }
        
        // Auto-run availability check on load
        window.onload = () => {
            log('Hermes 2 Pro Integration Test Ready', 'success');
            log('Click buttons above to run tests\\n', 'info');
        };
    </script>
</body>
</html>

